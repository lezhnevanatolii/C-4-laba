#include <iostream>
#include <cmath>
#include <stdexcept>

class QuadraticEquation {
private:
    double a;
    double b;
    double c;

public:
    QuadraticEquation() {
        a = 1.0;
        b = 0.0;
        c = 0.0;
    }

    QuadraticEquation(double coefficientA, double coefficientB, double coefficientC) {
        if (coefficientA == 0.0) {
            throw std::invalid_argument("Коэффициент a не может быть равен 0");
        }
        a = coefficientA;
        b = coefficientB;
        c = coefficientC;
    }

    QuadraticEquation(const QuadraticEquation& other) {
        a = other.a;
        b = other.b;
        c = other.c;
    }

    double getA() const {
        return a;
    }

    double getB() const {
        return b;
    }

    double getC() const {
        return c;
    }

    void setA(double coefficientA) {
        if (coefficientA == 0.0) {
            throw std::invalid_argument("Коэффициент a не может быть равен 0");
        }
        a = coefficientA;
    }

    void setB(double coefficientB) {
        b = coefficientB;
    }

    void setC(double coefficientC) {
        c = coefficientC;
    }

    double calculateDiscriminant() const {
        return b * b - 4.0 * a * c;
    }

    double* calculateRoots() const {
        double discriminant = calculateDiscriminant();
        
        if (discriminant > 0) {
            double* roots = new double[2];
            roots[0] = (-b + sqrt(discriminant)) / (2.0 * a);
            roots[1] = (-b - sqrt(discriminant)) / (2.0 * a);
            return roots;
        } else if (discriminant == 0) {
            double* roots = new double[1];
            roots[0] = -b / (2.0 * a);
            return roots;
        } else {
            double* roots = new double[0];
            return roots;
        }
    }

    int getNumberOfRoots() const {
        double discriminant = calculateDiscriminant();
        
        if (discriminant > 0) {
            return 2;
        } else if (discriminant == 0) {
            return 1;
        } else {
            return 0;
        }
    }

    QuadraticEquation& operator++() {
        ++a;
        ++b;
        ++c;
        return *this;
    }

    QuadraticEquation operator++(int) {
        QuadraticEquation temp = *this;
        ++(*this);
        return temp;
    }

    QuadraticEquation& operator--() {
        --a;
        --b;
        --c;
        return *this;
    }

    QuadraticEquation operator--(int) {
        QuadraticEquation temp = *this;
        --(*this);
        return temp;
    }

    operator double() const {
        return calculateDiscriminant();
    }

    explicit operator bool() const {
        return calculateDiscriminant() >= 0;
    }

    bool operator==(const QuadraticEquation& other) const {
        return (a == other.a) && (b == other.b) && (c == other.c);
    }

    bool operator!=(const QuadraticEquation& other) const {
        return !(*this == other);
    }

    friend std::ostream& operator<<(std::ostream& output, const QuadraticEquation& equation);
};

std::ostream& operator<<(std::ostream& output, const QuadraticEquation& equation) {
    output << equation.a << "*x^2";
    
    if (equation.b >= 0) {
        output << " + " << equation.b << "*x";
    } else {
        output << " - " << -equation.b << "*x";
    }
    
    if (equation.c >= 0) {
        output << " + " << equation.c;
    } else {
        output << " - " << -equation.c;
    }
    
    output << " = 0";
    return output;
}

double safeInputDouble(const std::string& prompt) {
    double value;
    bool validInput = false;
    
    while (!validInput) {
        std::cout << prompt;
        if (std::cin >> value) {
            validInput = true;
        } else {
            std::cout << "Ошибка: введите корректное число!" << std::endl;
            std::cin.clear();
            std::cin.ignore(10000, '\n');
        }
    }
    
    return value;
}

void demonstrateOperations() {
    std::cout << "\n=== ДЕМОНСТРАЦИЯ ПЕРЕГРУЖЕННЫХ ОПЕРАЦИЙ ===" << std::endl;
    
    try {
        std::cout << "\n1. СОЗДАНИЕ УРАВНЕНИЙ:" << std::endl;
        
        std::cout << "Введите коэффициенты для уравнения 1:" << std::endl;
        double a1 = safeInputDouble("a (не 0): ");
        while (a1 == 0.0) {
            std::cout << "Ошибка: коэффициент a не может быть равен 0!" << std::endl;
            a1 = safeInputDouble("a (не 0): ");
        }
        double b1 = safeInputDouble("b: ");
        double c1 = safeInputDouble("c: ");
        
        QuadraticEquation eq1(a1, b1, c1);
        std::cout << "Уравнение 1: " << eq1 << std::endl;
        
        std::cout << "\nВведите коэффициенты для уравнения 2:" << std::endl;
        double a2 = safeInputDouble("a (не 0): ");
        while (a2 == 0.0) {
            std::cout << "Ошибка: коэффициент a не может быть равен 0!" << std::endl;
            a2 = safeInputDouble("a (не 0): ");
        }
        double b2 = safeInputDouble("b: ");
        double c2 = safeInputDouble("c: ");
        
        QuadraticEquation eq2(a2, b2, c2);
        std::cout << "Уравнение 2: " << eq2 << std::endl;
        
        std::cout << "\n2. УНАРНЫЕ ОПЕРАЦИИ:" << std::endl;
        
        std::cout << "Префиксный ++ для уравнения 1:" << std::endl;
        QuadraticEquation eq1_pre = ++eq1;
        std::cout << "После ++eq1: " << eq1 << std::endl;
        
        std::cout << "\nПостфиксный ++ для уравнения 1:" << std::endl;
        QuadraticEquation eq1_post = eq1++;
        std::cout << "Результат eq1++: " << eq1_post << std::endl;
        std::cout << "После eq1++: " << eq1 << std::endl;
        
        std::cout << "\nПрефиксный -- для уравнения 2:" << std::endl;
        QuadraticEquation eq2_pre = --eq2;
        std::cout << "После --eq2: " << eq2 << std::endl;
        
        std::cout << "\nПостфиксный -- для уравнения 2:" << std::endl;
        QuadraticEquation eq2_post = eq2--;
        std::cout << "Результат eq2--: " << eq2_post << std::endl;
        std::cout << "После eq2--: " << eq2 << std::endl;
        
        std::cout << "\n3. ОПЕРАЦИИ ПРИВЕДЕНИЯ ТИПА:" << std::endl;
        
        double discriminant1 = (double)eq1;
        std::cout << "Неявное приведение к double (дискриминант eq1): " << discriminant1 << std::endl;
        
        bool hasRoots1 = (bool)eq1;
        std::cout << "Явное приведение к bool (есть ли корни у eq1): " << std::boolalpha << hasRoots1 << std::endl;
        
        if (eq1) {
            std::cout << "У уравнения eq1 есть действительные корни" << std::endl;
            double* roots = eq1.calculateRoots();
            int numRoots = eq1.getNumberOfRoots();
            std::cout << "Количество корней: " << numRoots << std::endl;
            for (int i = 0; i < numRoots; i++) {
                std::cout << "Корень " << (i + 1) << ": " << roots[i] << std::endl;
            }
            delete[] roots;
        } else {
            std::cout << "У уравнения eq1 нет действительных корней" << std::endl;
        }
        
        std::cout << "\n4. БИНАРНЫЕ ОПЕРАЦИИ:" << std::endl;
        
        std::cout << "eq1 == eq2: " << std::boolalpha << (eq1 == eq2) << std::endl;
        std::cout << "eq1 != eq2: " << std::boolalpha << (eq1 != eq2) << std::endl;
        
        std::cout << "\nСоздаем уравнение 3 как копию уравнения 1:" << std::endl;
        QuadraticEquation eq3 = eq1;
        std::cout << "Уравнение 3: " << eq3 << std::endl;
        std::cout << "eq1 == eq3: " << std::boolalpha << (eq1 == eq3) << std::endl;
        std::cout << "eq1 != eq3: " << std::boolalpha << (eq1 != eq3) << std::endl;
        
        std::cout << "\n5. КОМБИНАЦИЯ ОПЕРАЦИЙ:" << std::endl;
        
        std::cout << "Создаем уравнение 4 и применяем операции:" << std::endl;
        QuadraticEquation eq4(2, 3, 1);
        std::cout << "Исходное уравнение 4: " << eq4 << std::endl;
        
        QuadraticEquation eq5 = ++eq4;
        std::cout << "После ++eq4: " << eq4 << std::endl;
        std::cout << "Результат (eq5): " << eq5 << std::endl;
        
        double disc = (double)eq5;
        bool hasR = (bool)eq5;
        std::cout << "Дискриминант eq5: " << disc << std::endl;
        std::cout << "Есть ли корни у eq5: " << std::boolalpha << hasR << std::endl;
        
    } catch (const std::invalid_argument& e) {
        std::cout << "Ошибка: " << e.what() << std::endl;
    } catch (const std::exception& e) {
        std::cout << "Произошла ошибка: " << e.what() << std::endl;
    }
}

void testPredefinedCases() {
    std::cout << "\n=== ТЕСТОВЫЕ ПРИМЕРЫ ===" << std::endl;
    
    std::cout << "\nТест 1: Уравнение с двумя корнями" << std::endl;
    QuadraticEquation test1(1, -3, 2);
    std::cout << "Уравнение: " << test1 << std::endl;
    std::cout << "Дискриминант: " << (double)test1 << std::endl;
    std::cout << "Есть корни: " << std::boolalpha << (bool)test1 << std::endl;
    
    std::cout << "\nТест 2: Уравнение с одним корнем" << std::endl;
    QuadraticEquation test2(1, -4, 4);
    std::cout << "Уравнение: " << test2 << std::endl;
    std::cout << "После ++: " << (++test2) << std::endl;
    
    std::cout << "\nТест 3: Уравнение без корней" << std::endl;
    QuadraticEquation test3(1, 0, 1);
    std::cout << "Уравнение: " << test3 << std::endl;
    std::cout << "Есть корни: " << std::boolalpha << (bool)test3 << std::endl;
    
    std::cout << "\nТест 4: Сравнение уравнений" << std::endl;
    QuadraticEquation test4a(2, 3, 1);
    QuadraticEquation test4b(2, 3, 1);
    QuadraticEquation test4c(3, 2, 1);
    
    std::cout << "Уравнение A: " << test4a << std::endl;
    std::cout << "Уравнение B: " << test4b << std::endl;
    std::cout << "Уравнение C: " << test4c << std::endl;
    std::cout << "A == B: " << std::boolalpha << (test4a == test4b) << std::endl;
    std::cout << "A == C: " << std::boolalpha << (test4a == test4c) << std::endl;
    std::cout << "A != C: " << std::boolalpha << (test4a != test4c) << std::endl;
}

int main() {
    std::cout << "ЛАБОРАТОРНАЯ РАБОТА №4. ЗАДАНИЕ 2" << std::endl;
    std::cout << "ПЕРЕГРУЗКА ОПЕРАТОРОВ ДЛЯ КЛАССА QuadraticEquation" << std::endl;
    
    char choice;
    do {
        std::cout << "\nВыберите режим:" << std::endl;
        std::cout << "1 - Демонстрация с пользовательским вводом" << std::endl;
        std::cout << "2 - Тестовые примеры" << std::endl;
        std::cout << "3 - Выход" << std::endl;
        std::cout << "Ваш выбор: ";
        std::cin >> choice;
        
        switch (choice) {
            case '1':
                demonstrateOperations();
                break;
            case '2':
                testPredefinedCases();
                break;
            case '3':
                std::cout << "Выход из программы..." << std::endl;
                break;
            default:
                std::cout << "Неверный выбор. Попробуйте снова." << std::endl;
        }
        
        if (choice != '3') {
            std::cout << "\nНажмите Enter для продолжения...";
            std::cin.ignore();
            std::cin.get();
        }
        
    } while (choice != '3');
    
    std::cout << "\nПрограмма завершена. Нажмите Enter для выхода...";
    std::cin.ignore();
    std::cin.get();
    
    return 0;
}
